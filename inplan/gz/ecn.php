<html>
 <style>
	
	#top_div table{
		font: 12px/17px times,"Helvetica Neue",Helvetica,Arial,sans-serif;

	}
	 
	.tab {
      	    border:0;
      	    padding:0;
      	    border-spacing:100px;
      	    border-collapse:separate;
      	    width:100%;
			margin-top:5px;
			margin-left:20px;

			}
  #top_div td ,#top_div th
       {
         border:0;
         height:30px;
	     padding-left:4px;
		margin-left:20px;
       }
	.head_left{
		 float:left;
		 padding-left:150px;
		 margin-top:1px;
		 margin-bottom:10px;
		 margin-left:20px;
	}
	.head_right{
	       float:right;
		   margin-bottom:70px;
		   padding-right:20px;
		   margin-top:10px;
		   margin-left:20px;
	/*  border:solid 1px #99BBDD; */
		   }
	   .head_box_1{
		       width:100%;
			   height:50px;
	           border-bottom:solid 1px black;
			   margin-left:20px;
            }
	    .sline{
		       width:100%;
			   height:3px;
	           border-top:DASHED 1px black;
			   border-bottom:DASHED 1px black;
			   margin-left:20px;
			   margin-top:5px;
            }
      .head_bar{
		    width:100%;
			height:25px;
			margin-top:3px;
	        background-color:gray;
			font-size:200%;
			color:white;
			padding-top:5px;
			margin-left:20px;
      }
	   .head_bar_s{
		    width:100%;
			height:15px;
			margin-top:3px;
	        background-color:gray;
			font-size:120%;
			color:white;
			padding-top:0.5px;
			margin-left:20px;
	  }
	   .head_bar1{
		    width:auto;
			height:25px;
			margin-top:2px;
	        /*background-color:gray;*/
			font-size:200%;
			color:black;
			padding-top:5px;
			margin-left:20px;
	  }
      .head_box{
		     width:100%;
			 height:100px;
		     border-top:solid 1px black;
			 margin-top:2px;
			 border-bottom:solid 1px black;
			 text-align:right;
			 margin-left:20px;
	  }
	  .find_caption{
		 float:left;
		   font-size:120%;
		   line-height:25px;
		   text-align:right;
		   width:200px;
		   margin-left:20px;
	  }
	    .caption_value{
		   float:right;
		   font-size:120%;
		   line-height:25px;
		   text-align:left;
		   width:500px;
		   
	  }
	  .td_c{
	       text-align:center;
	        font-size:120%;
		   margin-left:20px;
	   }
	  .ci_note{
		  border-bottom: solid 2px black;
		  border-left: solid 2px black;
		  border-right: solid 2px black;
		  width:99.5%;
		  height:50px;
		  margin-left:20px;
	  }
	  .ci_note_1{
	     margin-left:20px;
		 padding-top:1px;
		 margin-left:20px;
	  }
	  .process_bar{
	        width:100%;
			height:25px;
			margin-top:5px;
	        /*background-color:gray;*/
			border:solid 1px black;
			font-size:150%;
			color:black;
			padding-top:10px;
			text-align:center;
			clear:both;
			margin-left:20px;
      }
      .trav_code{
             float:left;
	         width:91%;
			 height:20px;
			 border-top:solid 1px black;
			 border-bottom:solid 1px black;
			 border-left:solid 1px black;
			 margin-top:5px; 
	         clear:left;
			 padding-top:5px;
			 margin-left:20px;
	  }
	  .trav_code1{
		     float:right;
	         width:55px;
			 height:20px;
			 margin-top:5px;
             border-top:solid 1px black;
			 border-bottom:solid 1px black;
			 border-right:solid 1px black;
             clear:right;
			 text-align:right;
			 padding-right:10px;
			 padding-top:5Px;
			
	  }
	  .trav_note{
	    width:738px;
		clear:both;
		border-left:solid 1px black;
		border-right:solid 1px black;
		border-bottom:solid 1px black;
		margin-left:20px;
	  }
	
	  .attr_des{
		   float:left;
		   text-align:left;
		   width:321px;
		   border:none;
		   padding-left:5px;
		   clear:both;
		   border-left:solid 1px black;
		   border-bottom:solid 1px black; 
		   margin-left:20px;
	  }
	  .attr_value{
           float:right;
		   text-align:left;
		   width:412px;
		   border:none;
		   clear:both;
           border-right:solid 1px black;
		   border-bottom:solid 1px black;
		  
	  }
	  .trav_attr{

	  }
	  .conner{
	  }
 </style>
 <div id='top_div' style="padding:5px;width:740px;">
	<!--<div><center><b><font size=+2>Traveler Routing&nbsp;</font></b></center></div><br>-->
	<div class="head_box_1">
         <div class="head_left">                               
	          <p><b>Guangzhou Termbray Electronics Technology Company Limited </b></p>
		       <p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;广&nbsp;州&nbsp;添&nbsp;利&nbsp;电&nbsp;子&nbsp;科&nbsp;技&nbsp;有&nbsp;限&nbsp;公&nbsp;司</b></p>
		       <p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A member of TTM Technologies Group</b></p>
		      <!-- <p>&nbsp;&nbsp;&nbsp;A Subsidiary of Viasystems Group, Inc.</p>-->
	     </div>
	    <!-- <div class="head_right">
	           <p><b>&nbsp;&nbsp;&nbsp;&nbsp;广&nbsp;州&nbsp;添&nbsp;利&nbsp;电&nbsp;子&nbsp;科&nbsp;技&nbsp;有&nbsp;限&nbsp;公&nbsp;司</b></p>
		       A member of TTM Technologies Group
	     </div>-->
	</div>
	            
                                                      
                               
	<div  class="head_bar">		
		<p><center>工 程 更 改 通 知 书</center></p>
	</div>


<?php
    $headerinfo='<div class="head_box">
	    <div class="find_caption">
	        <p><b>Customer:</b></p>
    	    <p>Part Number:</p>
	        <p>Part Description:</p>
	        <p>End Customer:</p>
		 </div>
	   <div  class="caption_value">
	        <p><b>@@customer_name@@</b></p>
    	    <p>@@job_name@@</p>
	        <p>@@customer_pn@@</p>
	        <p>@@customer_code@@</p>
		</div>	
	</div>'; 
	$site = $_GET['site'];
	$job =  $_GET["job_name"];
    $sql="select jb.item_name as JobName, decode(cda.alternate_name_,'',cs.customer_name,cda.alternate_name_) as csName
		,ecs.customer_code as ecode,da.customer_pn_
		from items jb ,job ,customer cs, customer ecs, job_da da ,customer_da cda
		where jb.item_type=2 and job.odb_site_id=1 and job.customer_id=cs.cust_id and job.end_customer_id=ecs.cust_id
		and jb.item_id=job.item_id and jb.last_checked_in_rev=job.revision_id
		and job.item_id=da.item_id and job.revision_id=da.revision_id  and cs.cust_id=cda.cust_id
		and jb.item_name='".$job."'";
 if (file_exists("oracle_conn.php")){
		$pre_dir_scripts = "scripts";
		$pre_dir = "inplan/allsites";
		$logo_dir = "images";
		$image_dir = ".";
		require("oracle_conn.php");
		require_once("lang.php");
		} else {
		$pre_dir_scripts = "../../scripts";
		$pre_dir = ".";
		$image_dir = "../..";
		$logo_dir = "stackup";
		require("../../oracle_conn.php");
		require_once("../../lang.php");
		echo "<script type='text/javascript' src='". $pre_dir_scripts . "/jquery-1.4.4.min.js'></script>";
	}
	$stid = oci_parse($conn, $sql);
	if (!$stid) {
	  $e = oci_error($conn);
	  print htmlentities($e['message']);
	  exit;
	}

	$r = oci_execute($stid, OCI_DEFAULT);
	if(!$r) {
	  $e = oci_error($stid);
	  echo htmlentities($e['message']);
	  exit;
	}
	$row = oci_fetch_array($stid, OCI_RETURN_NULLS);
	$cust_name = $row['CSNAME'];
	$cust_pn = $row['CUSTOMER_PN_'];
	$job_name = $row['JOBNAME'];
	$cust_code = $row['ECODE'];
    $headerinfo = str_replace("@@customer_name@@",$cust_name ,$headerinfo);
    $headerinfo = str_replace("@@job_name@@",$job_name ,$headerinfo);
    $headerinfo = str_replace("@@customer_pn@@",$cust_pn ,$headerinfo);
    $headerinfo = str_replace("@@customer_code@@",$cust_code ,$headerinfo);
    echo $headerinfo;
    echo '<div  class="head_bar_s">		
		  <center>Part Layup</center>
	      </div><br>';
     $sql=" select *  from 
     rpt_ecn_affected_object_info ecn,rpt_ecn_info ecnd,job,job_da jba, items jb,customer cs
     where ecn.ecn_id=ecnd.ecn_id and ecn.TARGET_JOB_ROOT_ID=jb.root_id and jb.item_id=job.item_id 
     and jb.last_checked_in_rev=job.revision_id and job.odb_site_id=1 and job.customer_id=cs.cust_id
     and job.item_id=jba.item_id and job.revision_id=jba.revision_id and  ecn.target_name='".$job."'";
 	$stid = oci_parse($conn, $sql);
	if (!$stid) {
	  $e = oci_error($conn);
	  print htmlentities($e['message']);
	  exit;
	}
	$r = oci_execute($stid, OCI_DEFAULT);
	if(!$r) {
	  $e = oci_error($stid);
	  echo htmlentities($e['message']);
	  exit;
	}
	$row = oci_fetch_array($stid, OCI_RETURN_NULLS);
    $c_user=	'<table  class="tab" style=" border-spacing:30px 30px;">
	<tr><td width=50%>TO(致): S&M PROD PPC MC QA PRE</td><td width=50%>DATE:@@DFM_CREATED_DATE_@@</td></tr>
    <tr><td width=50%>FM(由): PE&nbsp;@@DFM_CREATOR_@@&nbsp;&nbsp;@@DFM_CHECKER_@@</td><td width=50%></td></tr>
	<tr><td width=50%>REV. Change From（版本号更改从）:&nbsp;@@SOURCE_NAME@@</td><td width=50%>TO（至）:&nbsp;@@TARGET_NAME@@</td></tr>
	</table>';
   $c_user = str_replace("@@DFM_CREATOR_@@",$row['DFM_CREATOR_'] ,$c_user);
   $c_user = str_replace("@@DFM_CHECKER_@@",$row['DFM_CHECKER_'] ,$c_user);
   $c_user = str_replace("@@DFM_CREATED_DATE_@@",$row['DFM_CREATED_DATE_'] ,$c_user);
   $c_user = str_replace("@@SOURCE_NAME@@",$row['SOURCE_NAME'] ,$c_user);
   $c_user = str_replace("@@TARGET_NAME@@",$row['TARGET_NAME'] ,$c_user);
   echo $c_user;
   echo "<div class='sline'></div>";
   $SOURCE= $row['SOURCE']==1?'[X]CEC（客户更改）CEC No.':'[ ]CEC（客户更改）CEC No.';
   $CUSTOMER_ECN_NUMBER=$row['CUSTOMER_ECN_NUMBER'];
   $EcnInner= $row['SOURCE']==0?'[X]ECN（内部更改）':'[ ]ECN（内部更改）';
   $c_user=	"<table  class='tab'>
	<tr><td colspan='3' >Reason of Change （更改原因）: </td></tr>
     <tr><td width=30%>$SOURCE</td><td width=30%>$CUSTOMER_ECN_NUMBER</td> <td width=30%>$EcnInner</td></tr>
	</table>";
   echo $c_user;
   echo "<div class='sline'></div>";
   $Desc=$row['DESCRIPTION'];
   $c_user=	"<table  class='tab'>
	 <tr><td colspan='3' >Description of Main Change （主要更改内容）: </td></tr>
	 <tr><td  style='height:60px;' width=30%>$Desc</td><td width=30%></td> <td width=30%></td></tr>
	</table>";
   echo $c_user;
   echo "<div class='sline'></div>";
   $MASTER_ARTWORK=$row['MASTER_ARTWORK_']==1?'[X] Master Artwork':'[ ] Master Artwork';
   $INNER_LAYER_A_W=$row['INNER_LAYER_A_W_']==1?'[X] Inner Layer A/W':'[ ] Inner Layer A/W';
   $DRILL_TAPE=$row['DRILL_TAPE_']==1?'[X] Drill tape':'[ ] Drill tape';
   $OUT_LAYER_A_W=$row['OUT_LAYER_A_W_']==1?'[X] Out Layer A/W':'[ ] Out Layer A/W';
   $CURRENT_INSTRUCTION=$row['CURRENT_INSTRUCTION_']==1?'[X] Plating Instructin Paper':'[ ] Plating Instructin Paper';
   $SOLDER_MASK_A_W=$row['SOLDER_MASK_A_W_']==1?'[X] Solder Mask A/W':'[ ] Solder Mask A/W ';
   $LINE_MASK=$row['LINE_MASK_']==1?'[X] Linemask Film':'[ ] Linemask Film';
  
   $sql="select * from rpt_ecn_affected_object_info where target_job_root_id=".$row['TARGET_JOB_ROOT_ID'] ." and source_name like '%填孔铝片%'";
   $stid = oci_parse($conn, $sql);
	if (!$stid) {
	  $e = oci_error($conn);
	  print htmlentities($e['message']);
	  exit;
	}
	$r = oci_execute($stid, OCI_DEFAULT);
	if(!$r) {
	  $e = oci_error($stid);
	  echo htmlentities($e['message']);
	  exit;
	}
	$row1 = oci_fetch_array($stid, OCI_RETURN_NULLS);
	if ($row1)
	   $filling=1;
	else
      $filling=0;
    $Via_Plug_Aluminium =$filling==1?'[X] Via Filling Tool':'[ ] Via Filling Tool';

 $sql="select * from rpt_ecn_affected_object_info where target_job_root_id=".$row['TARGET_JOB_ROOT_ID'] ." and source_name like '%封孔铝片%'";
   $stid = oci_parse($conn, $sql);
	if (!$stid) {
	  $e = oci_error($conn);
	  print htmlentities($e['message']);
	  exit;
	}
	$r = oci_execute($stid, OCI_DEFAULT);
	if(!$r) {
	  $e = oci_error($stid);
	  echo htmlentities($e['message']);
	  exit;
	}
	$row1 = oci_fetch_array($stid, OCI_RETURN_NULLS);
	if ($row1)
	   $filling=1;
	else
      $filling=0;
    $Via_Plug=$filling==1?'[X] Via Plugging Tool':'[ ] Via Plugging Tool';

   $sql="select * from rpt_ecn_affected_object_info where target_job_root_id=".$row['TARGET_JOB_ROOT_ID'] ." and source_name like '%Laser_Mark%' and source_name like '%Laser Mark ID%'";
   $stid = oci_parse($conn, $sql);
	if (!$stid) {
	  $e = oci_error($conn);
	  print htmlentities($e['message']);
	  exit;
	}
	$r = oci_execute($stid, OCI_DEFAULT);
	if(!$r) {
	  $e = oci_error($stid);
	  echo htmlentities($e['message']);
	  exit;
	}
	$row1 = oci_fetch_array($stid, OCI_RETURN_NULLS);
	if ($row1)
	   $filling1=1;
	else
      $filling1=0;
    $Laser_Mark=$filling1==1?'[X] Laser_ID':'[ ] Laser_ID';
	$LEGEND_A_W= $row['LEGEND_A_W_']==1?'[X] Legend A/W':'[ ] Legend A/W';
	$V_CUT_DRAWING=$row['V_CUT_DRAWING_']==1?'[X] V-Cut drawing':'[ ] V-Cut drawing';
	$ROUTING_TAPE=$row['ROUTING_TAPE_']==1?'[X] Routing Tape':'[ ] Routing Tape';
	$AUTOMATIC_BEVEL_NO=$row['AUTOMATIC_BEVEL_NO_']==1?'[X] Automatic Bevel No.':'[ ] Automatic Bevel No.';
	$PUNCHING_DIE= $row['PUNCHING_DIE_']==1?'[X] Punching die':'[ ] Punching die';
	$E_TEST_FIXTURE=$row['E_TEST_FIXTURE_']==1?'[X] E-test Fixture':'[ ] E-test Fixture';
	$OTHERS=$row['OTHERS_']==1?'[X] Others':'[ ] Others';
	$IMPLEMENTATION_NOTE=$row['IMPLEMENTATION_NOTE'];
	$c_user=	"<table  class='tab'>
	 <tr ><td colspan='2' style='height:20px;' >Tool History （工具更改追踪）: </td></tr>
	 <tr><td style='height:20px;'>$MASTER_ARTWORK</td><td  style='height:20px;' width=65%>原装菲林</td></tr>
	 <tr><td style='height:20px;'>$INNER_LAYER_A_W</td><td style='height:20px;' width=65%>内层菲林</td></tr>
	 <tr><td style='height:20px;'>$DRILL_TAPE</td><td  style='height:20px;' width=65%>钻   带</td></tr>
	 <tr><td style='height:20px;'>$OUT_LAYER_A_W</td><td style='height:20px;' width=65%>外层菲林</td></tr>
	 <tr><td style='height:20px;'>$CURRENT_INSTRUCTION</td><td style='height:20px;' width=65%>电 流 纸</td></tr>
	 <tr><td style='height:20px;'>$SOLDER_MASK_A_W</td><td style='height:20px;' width=65%>绿油菲林</td></tr>
	 <tr><td style='height:20px;'>$LINE_MASK</td><td style='height:20px;' width=65%>Linemask 菲林</td></tr>
	 <tr><td style='height:20px;'>$Via_Plug_Aluminium</td><td style='height:20px;' width=65%>填孔铝片</td></tr>
	 <tr><td style='height:20px;'>$Via_Plug</td><td style='height:20px;' width=65%>塞孔铝片</td></tr>
	 <tr><td style='height:20px;'>$LEGEND_A_W</td><td style='height:20px;' width=65%>印字菲林</td></tr>
	 <tr><td style='height:20px;'>$V_CUT_DRAWING</td><td style='height:20px;' width=65%>V坑指示</td></tr>
	 <tr><td style='height:20px;'>$ROUTING_TAPE</td><td style='height:20px;' width=65%>锣  带</td></tr>
	 <tr><td style='height:20px;'>$AUTOMATIC_BEVEL_NO</td><td style='height:20px;' width=65%>自动斜边编号</td></tr>
	 <tr><td style='height:20px;'>$PUNCHING_DIE</td><td style='height:20px;' width=65%>啤  模</td></tr>
	 <tr><td style='height:20px;'>$E_TEST_FIXTURE</td><td style='height:20px;' width=65%> E-T 夹具</td></tr>
	 <tr><td style='height:20px;'>$Laser_Mark</td><td style='height:20px;' width=65%>激光序列号</td></tr>
	 <tr><td style='height:20px;'>$OTHERS</td><td style='height:20px;' width=65%>其它</td></tr>
	 <tr ><td colspan='2' style='height:20px;' >$IMPLEMENTATION_NOTE</td></tr>
	</table>";
   echo $c_user;
   echo "<div class='sline'></div>";
   $DISTINCTIONS_NOTE=$row['DISTINCTIONS_NOTE'];
   $c_user=	"<table  class='tab'>
	 <tr><td  style='height:30px;'> $DISTINCTIONS_NOTE</td></tr>
	</table>";
   echo $c_user;

   if (!$row['SUBJECT']){
       if (strpos($row['DISTINCTIONS'],'1000')>0 and strpos($row['DISTINCTIONS'],'1001')>0){
	      $Distinguish="[X] Date Code 周期:____________; [X] Job Code 工作单号:___________;";
	   }else if(strpos($row['DISTINCTIONS'],'1000')>0){
	      $Distinguish="[X] Date Code 周期:____________; [ ] Job Code 工作单号:___________;";
	   }else if(strpos($row['DISTINCTIONS'],'1001')>0){
          $Distinguish="[ ] Date Code 周期:____________; [X] Job Code 工作单号:___________;";
	   }else{
	      $Distinguish="[ ] Date Code 周期:____________; [ ] Job Code 工作单号:___________;";
	   }
     } else {
	      $Distinguish=substr($row['SUBJECT'],0,strpos($row['SUBJECT'], 'T')-5);
	}
     //mid({RPT_ECN_INFO.SUBJECT},1,instr({RPT_ECN_INFO.SUBJECT},"T")-5)
  if (!$row['SUBJECT']){
       if (strpos($row['DISTINCTIONS'],'1002')>0 and strpos($row['DISTINCTIONS'],'1003')>0){
			       $Distinguish1="[X] Trace Code 追踪标记:____________; [X] Others 其它:____________;";
			   }else if(strpos($row['DISTINCTIONS'],'1002')>0){
				  $Distinguish1="[X] Trace Code 追踪标记:____________; [ ] Others 其它:____________;";
			   }else if(strpos($row['DISTINCTIONS'],'1003')>0){
				  $Distinguish1="[ ] Trace Code 追踪标记:____________; [X] Others 其它:____________;";
			   }else{
				  $Distinguish1="[ ] Trace Code 追踪标记:____________; [ ] Others 其它:____________;";
			   }
     } else {
	      $Distinguish1=substr($row['SUBJECT'],strpos($row['SUBJECT'], 'T')-4);
	}
      // mid({RPT_ECN_INFO.SUBJECT},instr({RPT_ECN_INFO.SUBJECT},"T")-4)
    echo "<div class='sline'></div>";
     $c_user=	"<table  class='tab'>
	 <tr><td  style='height:25px;'>Distinguish Identification (分辩标识):</td></tr>
	 <tr><td  style='height:25px;'>$Distinguish</td></tr>
	 <tr><td  style='height:25px;'>$Distinguish1</td></tr>
	</table>";

	if ($row['IMPLEMENTATION_T']=="Due Date"){
			       $IMPLEMENTATION="<td style='height:16px;' width=30%>[ ]Immediately</td>"."<td style='height:16px;' width=30%>[ ]Waiting for new S/O</td>"."<td style='height:16px;' width=30%>[X]Cut-off date>";
			   }else if($row['IMPLEMENTATION_T']=="Pending Sales Order"){
				  $IMPLEMENTATION="<td style='height:16px;' width=30%>[ ]Immediately</td>"."<td style='height:16px;' width=30%>[X]Waiting for new S/O</td>"."<td style='height:16px;' width=30%>[ ]Cut-off date>";
			   }else{
				  $IMPLEMENTATION="<td style='height:16px;' width=30%>[X]Immediately</td>"."<td style='height:16px;' width=30%>[ ]Waiting for new S/O</td>"."<td style='height:16px;' width=30%>[ ]Cut-off date>";
			   }

    echo $c_user;
    echo "<div class='sline'></div>";
    $c_user=	"<table  class='tab'>
	 <tr><td colspan='3' style='height:16px;'>Implementation Status(执行状态):</td></tr>
	 <tr>$IMPLEMENTATION</tr>
	 <tr> <td>立即执行</td><td>等待新订单</td><td>截止日期</td></tr>
	</table>";
   echo $c_user;
   echo "<div class='sline'></div>";
    $c_user=	"<table  class='tab'>
	 <tr><td colspan='2'> Approved by( 审批):</td></tr>
	
	 <tr> <td>PE:</td><td>| PPC:</td></tr>
	</table>";
   echo $c_user;
?>
</div>
</html>